sudo: required
services:
- docker
before_install:
- docker build -t $DOCKER_IMAGE .
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker push $DOCKER_IMAGE
script:
- docker run -it --rm $DOCKER_IMAGE py.test
- docker run -d --name scan_me_please -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_KEY=$HALO_AGENT_KEY
  -e SERVER_GROUP=$SERVER_GROUP $DOCKER_IMAGE /app/run_with_halo.sh
- sleep 10
- export HALO_AGENT_ID=`docker exec scan_me_please cat /opt/cloudpassage/data/id`
- echo $HALO_AGENT_ID
- docker run -it --rm -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_ID=$HALO_AGENT_ID
  -e COMMIT_ID=$TRAVIS_COMMIT -e GITHUB_PROJECT=oaklander/don-dash -e GITHUB_TOKEN=$GITHUB_TOKEN
  docker.io/ashmastaflash/squealer
- docker kill scan_me_please
env:
  global:
  - SERVER_GROUP=don-dash-cicd
  - HALO_API_HOSTNAME=api.cloudpassage.com
  - HALO_API_PORT=443
  - DOCKER_IMAGE="oaklander/cloudpassage.don-dash:latest"
  - secure: Vgz6OZiyYH5xwMBdwgmF8r7rbeFuPedPWv/0mE1+M/29rZHCnuoRImqX+OcjV9IiKWorKS+AqbLy4vTBXAzXVnfvU2UUVCbzHDQwVaFaGLYby9HAJT8s4wnsT4tNrlemZnOJfdgeE51k8JQrEIDSZ3Emyi6u6HG6B3TyUt8c6LLvxbuGrRjp56NHeMv+iQws88LFgkxBLbjN6p89622G8J9R5oZlD9uwpkNgilGqJ8NUgDVqr1XG1OLK6YAG5RIgI9Mur3zUzipMhVH/mDQYd3FwSSUiDI5McKJ/Z7EP62XJ/0W/AaalSzy0+0oa/yi/nMIt+kx2e8fdTaUqtJL83qTkJpPKzjJKZElzRlHCYjryVkxSJSyQCxJuFTTHi7vJRkynG/WARiHGwndgxnMsBVKpTSPVYPFKgbZCJSWAprGu+1qI6c8iZRtl9p7DgERgzp9lGe3PZWi3ET/9cFL7CEnyl75ynLQ4qkiGLhIow1njZ19y25GG+U+AixOlOYLeZZ2uVhDyJccWodQfruRCdRegAN+QczYUOAIhPL4FF9kowNuhJy3BV45LCjQ4meHmq/0O4k5a6bnukaZmw2XwPYtXseg56euB2dRCEPShsusCOSkans1qIfEV56sxTFP4tphQ7o9jNdW1Fnt3YNKk7TOEcL11Qcq+YxfM828Huaw=
  - secure: M5a4DzFxpbpgULFF075OM1yNW+7sd2O0ZocSAQsq2zKZigBZxW7JFR/Sm5HgHqPz9giLkn19BdrY88IOvWuQeWUFzi8N/xOSVl6/8xMwmxaS79lL4P1h6TXjBy6A22c8v90iCNZsN0ofaIPjD54iWXvV/OmNUNfh7WIKKaG0fBcwoA6aAleHmGumpVKLlMfoi8uIH3R3y4D/KYqTCl23fjZSatZB38yeA4asvNPTdFKWalBGwG0BcYSZM7qaJY0WLbMCvxdwmWCXHiww9QnGe2LhDbxZsskEo/LAjLTBkJmQRVJR7yia8YAALbVbZr7eSiK7bO0gsWGm7IBfH/FwhONJA6X9VtW111/gqwb0GZgpxQEq9s+PdoR7wQ22WRGS4/+apc0hE9XWUsItTeKtVPZUjAVs7q0nnjOh2UbGg+8umkMPhd/XUPxxWhQNAd3w/pgwtYUqMR/Cp/Xa/i1uQTfTJE/+kxPgkHEtuGvIl4pA7+/LIJM2S5SZgnneCJTeyC0CsMZoiFWRR6CfOKQnYQvz2fiaoN58Bwv8VktzDHAu5dyo+ztu/1YPr4IBy950q5SObPkyiJflftxiLnm9JkbGH6t0WrlvH/ZJUlLTjBHlBV5ERrENW9DLwdMy8YzHUMX5GHdnoT2t86qb314ck/1mbijJnDF9PPfsnwmWGe0=
  - secure: ftJx4jgnw+KrN4D1ugIb0q7rHIxqGCKtnVrlU9Mjd+V+NBiK1qA8cHmfw7EoK/QVp5KbIr3w7J2HLJb5CHBubBbnylY6HpwRd2dMTd/jsWsyejW1G/XDhnCONK93dv5LC/hkClb69s95aMQ84DUspPs0SrtxNG/gFuWFx2imQjFMmbKSkcphRc5nk4Xs68+A6wztCUuHyPrmLMkflM60o66OU+Wq9Dv9Lzn0uFEQZYjPMNCaCKpI+SXvh1BmZ8o53B8UbxEjuTKAAJ3aQoxBKa3EDabNqqysJiV8YBwBz5CCrn3YmdIt6WebLghT9yLYZn9YSG2gWKnX0ut3kbTxrlpQ8TNWyrcAhyFn7/NSuN02rCCMZDOTqOUwY8LDMFEEfgkr97UgyRpfF0ey7W1MfVc5TaDZaStThh/KBca7KVR3ZulEN2LRZ12zj6T0IrBm+r7dNmY67ymt6Vo+n/x4M3PVMpeKv2+AtZZFdrsIDq5Hmx5zCUUUuZts4bstbyHImnb98IdsDL+/sxJTKku+aPNgBlTkFfovajLSrAzZTmk4zW7x2GpjZQqoc4kueddWH7PIDbN3Rskl3gi2OxkBD/4RqPtQDgp40ph+TA11/N+KEMTUJLOA8BflwKdsDN3ediAizsghaFmcVLHwReGgGaRoQETsUYShTizjwCnOnm8=
  - secure: EC61vLfwLx97N4TBX/ePGLWZRngPxnQf9JJ2+uQkmZT9P8Q0OCqfxztZtWw1TQW68Y8vpuj7DUJ+zDxe4ZxZ/MgRhT0e5BZVd5LtqDFtn3rC4kTbo4t1xKpAk8+HVEgtr9E80XQIBuQxKwo9M8MSkGpvdB5816BNFzZ7ql5bL36l3S4Wqr+scVuGago/UrXGtfPDQwBQ05ff7aGu5VEwwgDQ5hA/01RutL0Y18NbsrJnIp1rBqTmN1db9OeTmHatPsXwcFmUO872g/JDaKvbtiNyxkVlB6zVHm6ddHfCHuIPYsUJtIn9zMlxiTbp/A71fzfeurDGyh8i4UY4fbGgwavCPFjd2vOgiEorNr47NvvYT2ngaDQy2uwwVvTFBknnHSfaFF7oN6tycqtIHkdLEpV5xvvt6Aa6E2/lqGsMxx++hPEEAx1J1OxaIhqOxhJdRGnDRiKsDPGSD6POmI4vytUvDdlwJZkxVwkSfm6+Y5rG/wOfHktHMiXqIEdXShOJTVODELpmU9oqYYE+9GLxvp0Z2lz5JGxEpSqUmzid7HjlB/Nwa9zl6rqNFR6J98Z6lgovn4XLoJL4pxg1F0JI5WqMYPhINmHb8+rgszk9Jtz98rZjgprvMmQ5FS90/NSCQMjhR+I3K7B5Nu2xbojMYu2IhC572A6unjXnRcFrrcI=
  - secure: UxGVWN/PBCgLhUQ7B+UrdgkNLZFTQjxMQiegT7WSlH2n7qZzOIml7N+3hY1/jsi244EcyohBt5M6w2544v9GN9j9UeZ2FWjCtF9MN6I0h6XshsBjxB5GW3JPSQUE6DPxKQCw6IcDDWpBRZNggn5aJkYsz3HUBl+9vsJ+fBOnOnDwYO2O2+aXMc4WP3CrZMT3L14ZPnEdAq4OcxSw/qqs4RxlVTRhkbD0iGhdk6wm8yKi0OwAQ9fDN8GAQHcpfN0tBXfHruEHDFptJs4kPeHUJEr5Jx8yq7Cy+8cskzfr3/XtPsVcqPHFDMGcd0TTJF8/hL8CEAIKoals7OLq43DGy6GKGiEtJ070k8o0NlXcIe25D6IzThNUKK5FFUjvFstqEUZt6Ikaa8C9Bm/Psb8s+VuFjmjaWu5rAnzwTMgRlB3rWycytpWfjEFmp3/Xw69NqOl0k7Zm06SfOtCu3XnGxIMrcEsVEzANsWyB6JYnoTsUe2MrWCvdF5otzzUPMNwwAwRh+0SCusfwSkSv3RvZyqDCq9kEbr84BM9/CS2qNTdrdB8CUN2OsO6qoktmua9qeMMCEVl5xb8DwDmMdPyAn+VzuJk6dY6CZuSVZfFEViCvAHfgLHpt3ioMies+cTFFDykZRt7Xr5nibsGhrjo1lDOw7YE2CSpq/pyWjly3yuA=
  - secure: M4EH34Pov+KvHTPNstUM514bPZkH41DnwxQGiYvqobZxsfN6qKgILqUQ56XBvZsSwQttcxzLjT628BKJtJnG7lIil9F6L++iV26HI2rqiO6ktC3QJDDgk4/Y5+tul0d0BDn5EUBHLiJ2uqVAF5t5fG+DvBtXyfPd/xyfkIc4IuTtwiCOXx6H5TVsM8qglvO6jiEc9oGf7c63fUaJLy2DvpPlQzkUkn16rC56iCYfAuPlWXOEITfdJ1xfXeGpqSmy4jvkMeBb9aARCF7s2RN8XD2V1e9hM66/B+VQgj5BFcI69VImdBHu7UA/APtEgaHxNtvdYhMKQvyEaJ1bVBab3/Rp5SnyLYPGOBE0OZEHzHRkYCxx+V4+5LUavWvFeLZTErGh7BveSeW3MZoiaFNLjSIm1igA6nl2uBll3/fegR3YG1kXyX72frl/E+ihlSg306jP72eetlsUvDYRHeks9R2wMn3hWWtWElz1Wuxwrph1iuaUd4oy/fYY14aAem12dnGXWZqHGSVCQnJQfgx+jrcGkoO06vg5RvvR0pFwPTOuNr2ZPlt9Oj8/8cdU2sx3sNbVtw2DKMUnPJjIL18O2UPIlEb/3AvW11CT7oHSdNg+h82YDBqaGemI/sI5U5dwpGdSWagsBVB3i6VlFdtO3ZFCq1bIqm3143WPr6ACCxE=
  - secure: ZYsqDrIKXJuWKKQDkvpFi2UiaGX7aS6n414TOsFXgsXBW2zFkLHUUd0efrO8rSQJnXmd4QJ5s0fU25YCtZnVSnUkov3wcHbX6zCz06zlk2TDOGJTiz9H26Wwt72QMibFGztVXwlyTD1iYKNdWQPl53W/O4cHaMJeL8O5dm0pzdUdMtifFWrrMozDuH0d0VKkt8x3Ma8CbRsKXQ51XsfTgtIOguH/6YL0lmHWy9BVp/ttusi2c8KKpSkt+4AF5pQPVGM27IuufLq71PU1wT5lSQcjpSnK/abfB4bJXk9oaRl5aWam8AuDU9xxzIHs6HIwzFmn5JqWi+NIZaJNi2b/RUPH/6tT/czkKDCLxqoVP+r/YR5iVw78bkjNRSHr0+LqPucKHEhsYTrNjs49ZlAVVwupcd0Cvuo2MOUIdVO9nYcHlZQqbPGdCJLQl/ZAbqstZuusLqeE15cdt0RvGeFs4V99ynX2Tyj9wT92Yllmn2Ogy1x2AAGjwfNSqNHpuICr2snO5bpiVBRLXww4pf8LFHWip4c/a+u53PYpkkHpgnkJM0NVkogx1RFlywz93/L9tGnehLEdT37kgcJKRCAXgpeCCm0BxLDVYNy1LvePrxtM+tTsIZOnLkxzHsdPnv5LMn0qNkVvt6kr5FfwGOf4b9Sifm75uzRTSK6wz4u1Kww=
