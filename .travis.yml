sudo: required
services:
- docker
before_install:
- docker build -t $DOCKER_IMAGE .
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker push $DOCKER_IMAGE
script:
- docker run -it --rm $DOCKER_IMAGE py.test
- docker run -d --name scan_me_please -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_KEY=$HALO_AGENT_KEY
  -e SERVER_GROUP=$SERVER_GROUP $DOCKER_IMAGE /app/run_with_halo.sh
- sleep 10
- export HALO_AGENT_ID=`docker exec scan_me_please cat /opt/cloudpassage/data/id`
- echo $HALO_AGENT_ID
- docker run -it --rm -e HALO_API_KEY=$HALO_API_KEY -e HALO_API_SECRET_KEY=$HALO_API_SECRET_KEY
  -e HALO_API_HOSTNAME=$HALO_API_HOSTNAME -e HALO_API_PORT=$HALO_API_PORT -e HALO_AGENT_ID=$HALO_AGENT_ID
  -e COMMIT_ID=$TRAVIS_COMMIT -e GITHUB_PROJECT=oaklander/don-dash -e GITHUB_TOKEN=$GITHUB_TOKEN
  docker.io/ashmastaflash/squealer
- docker kill scan_me_please
env:
  global:
  - SERVER_GROUP=don-dash-cicd
  - HALO_API_HOSTNAME=api.cloudpassage.com
  - HALO_API_PORT=443
  - DOCKER_IMAGE="oaklander/cloudpassage.don-dash:latest"
  matrix:
  - secure: VhJe7HxdEI3Omphc6YI4x4vR8yUNoHm75mrcxvxBtpF3GooC56nRoDNJARZEBANavQOP1X8nc0lYN20Ik/HHlEFEwxqMcM5Dj5Ow4tOYq5Njc4Mn8twwbPgiRQI21Yl3n2l1IZQ93oCm5BQISYHaPwsXYiqLC403mrmARtHfyU2FtkYCPFQNSGDnae1PywuUia7kPCxW0jPS65q/HQhtgrUV4TTauqgmPBkJhEGGVbiU9OYRC0B0gY8uWFkxRfWQG/bIDXeizEHZLbaBbSIBKzpNTATrl0fIMeWwCFvq2Ha4OGOKdrhXSBzU1X9OZzV3fDeaMG/o+BRBaozQrFgtnbw6vcdxUPttpEIDzzcCn7ZQnlucNMgVJAZe6k10aOpX1u+19r1yHuXGDHMlvr/GQ4sdiSOiZeS0fUMopGYBei88IXtuOZAqr8ZpmLx9yaH6b3KaE5HNLl6ktJ45C/QjxyR+jhJW7WXF16AbMjxvF19cYZnJAUMSgdccA/gT3SS9f6rRQlu1N+GUH6JiG8Au4XCVOxEXH+OiCV/A/mkGZnDOtyIVZ3T2Bm405J3un9kvHG5Y7Th3lrd5BvIkyVLxSUp76zj9gmmcjMjTsT5eY7Ph7f2qKhKPWCbuSeLy2AAoNSHjYgvOXkrQxMENFEX4tXiTC4CHaYSQ28nSXrtu93o=
  - secure: NllyFgg7/LykCaRL0iKeV1oIq7SanCc5/3tWNRyHWh2ixwCfRwFS/aRJepOdf+h5pG9iVYE3rjNKtwFhqsNjnyoBUwB8G5l0KLX333g1BjbofewuppZHKEJf1sxGeX7nfROJJjlCJFrRywdwh7m09klMN+WEUdpr0eHGTlLyQ7tFFMuOrQZngK8iLrdLZPdQnkzYwIUH3lwlhD+8E9QBe0unOQADa8UK9P3clg6RwOi38Im+gMZuWXFgGa2V79BpTsEhYS2LhGYtxinAel4r8heUhbgf0Se47kaD4KTiKUonBtB85S0VvsN/B4fpQBxVl4L1ZwL8vPm7Rtzih3TGUqvCHLDwaK6orbx53XcNK+Lcm9D0Lg8TWMS+sYy+TeZi7rvFHsAAepunppQcDluf65Q+3VGMjkZdy1GwdiupJntpW+BY55TyueXe0QOiK2j7BKfXt/or1JbgoSfZVcaAR8G5t7wnadVgAq8vj3JLpTxBDo3pyX5tg9HWC7QVeFKMwCsGUBGyDq1gSBtL4yyAUa2k9SnxxkfN6Md7n92PvMtRjg+KFH+qXFyfEzSdT/jTeYzXyiiKlKmaYnnVhVCHsBmjfYd4DWa+rqpGlo6s50Or48zmTdnb6Ilu+/Ecd0UvyHIQau0AHj0sReKBdGaGG2u3qjzZ7bGWp33KNKqRmKY=
  - secure: Y2Tjs9hdrpTyA8e+wDtYlgnn4yJX2Eto46YzQIwL7XcaT/ili69r4EPqKB9iAm+EkX4OuQH1YA+cDd8hjyknZMbHsgq94dxczIeVpLcHKM0zk2nHxy4CLNCCjzDvn7QAtp7SjOf9tQOv5dr3z10ALK0UWP/hCktQHLFwJubKRtNloeVqaScIbCdk7sDqkYnyQN8bZSL3kTPpNzTU7OLJvyKnVRzv5mwPCefqTJWGSNLTtSrQemedBT4qfOe+6IgdRSC31SSLqngep//AYM+U89+V6tSMrQbVcCkuoAFr20qLFdmnvei7ycVSeiGYr+yWA/CByT5UT6lbqgr/SxBBInMHCCj0sPi5HRPQ/kIa8GzxqKPUZvkfDHt4aN3vwCuHRnqrGnL8GkDCFjp1Y1NqzsxiDNyfCgbZlBNY3gEgga92SZ5bNZKZ4tRw8l75iOh1W72UAJ2RjG/y958Hd/pVZ3RlIyolAsimRjsccgf22AXB+TwhYREvbu4Xb0zULnad1JBJyqTXhnCjTwFPLzBA/OHvqkKhnjeBI4tqY03bXYOLVTob3gootiWDuD0co5DpSoNPYl3oY+rPz+CVa3cP0CyRbZ8V/elKs6vL6mG1BD3V1VQcxgROrlkRz4dd8CnsQ+sYnOoXeJabQWXw17Mzk3Vgk6WKxq4QG+iDNMNewww=
  - secure: BgY7GCUW9JeRIp+cnPY3U50jWNhzarrNcVuZWOZB/enSanv3wa8Ot02P6/AAcZ4zQzhMqo5feF61vPNCcZonqwyrX8vlHXC/bg/LBzVCMw9M5DRaF/l2xKMg9SYHdWDjemQHeTCQt9k4hYYekKSDUYJhPJwq45eOrZHWJ3gPcy6yOWi/OxaWSoy2tCPbUjf3MLkdJvKtW17pMvcjImp5PXtnzygaTU8l/curpa/I4BH3fJpzP74zBiK68/gCMunfBoUXJpPw/zw5Yo9I4DUInc1rLeF3dWehoCC89PFiorUYv2gALsMcMWtAdDxJcg9pulOri1wje+yQQi4ltXJr9cVAnnKjaMv+jzbRDrVDRiahsJVOs70DVnwA6Y1vVBistmRGIkm5ANS1SPYYL+DomiLO69Qwrun1xK9BXvAy0a+mk+6zMI/cWOvF6HtXT0JCCZZR/nKTMRvD0rb2S5LF5ppoOT0GArxO7sgfHFsAZo0xZjhrlBFk9QvUxqeWbE9ib7BW/sMravWUrap/T1tiW7Z0s3Eh7lmuFzkO22M8DeqduaAhDuelC5Jcci9QxknmY4Y4/GqeScMujnHBzvbZyzqgAyp/svqhuTs/LeOhm2DWRagBDISuEOyXezHpeG6lpkMYflZXhJd1zB355tma15qGRoS78mpu6HQ9ldeLFNQ=
  - secure: IXApR5xoENk3bRhlTrSMXRrP5BzFaMT7DSB/P3EaI8skQy8GDqxgdxCBDmMMmUWpC5PS75tOlWPdx6TFvKEIxWHKoBo5LCWiF+2nxXDgUmjgLfDzBmW5BX0h6AelioKg5JdNPGxySNG3PeFNf1t8HceHkrUuIQsoWsKiqWPvCO4UMK5y2EpG8gqBHbd1/R+xaQNinBBy8ac+iQvNPWtTaX90ieYyb4wAg2hLvxqjORREqj8qkR9lXLwxAn8wyx6/E/3t3LbbeTNp1DEP7OPikxKPjbM6pk8++TNd+eGj6eH/2HoCPobzq/PDcn2F++THdFtH+qDxfbJDsFCUTXNewb1R0k8dsHKDYwDzjBlSZu4zIPOhVI2BY8OVUkXh7vylCzrAfpspgNetHsPS/ELQoMz+jyc2yaDFvuD371/WGW8ryrv+QLdH1YlfvTEY1tciq6MAEiBpodUFxK+VJc9ItmE2NpXfpPbsrV8PLycRdAwwidLfvcZRLSbTCTOWqRzXY7gyj8dSq7/5N5n3q7JH08nb/NjqlCyJY0mDkKmDbNgVdSxeYbTvgFNoRQajsm4ExRxmTvXnO1+c6vLe5XGaqtZvBquz5obGWeMEfiU/bHUvnejez+zGgNTXgHGtNsyrZCtmshbYu1RP0rY9qASnOLEb4z4hIyZm3mMALDY37xo=
  - secure: kf7TkvzplncZ+Psx6BNSoa8/Jrlmtwbh+ZeJVZuFXwoJOyDtDO7ooNANv3DMn6Dt9u1bp9gGdtdq6w84asWLGB595nD8ND3UPudp0VoVSLmpkwRGByrUYIOikML3dMedZbR2Z/B9NFPaOgXuZvId6oHmy3oGUPWpgwczOlzfJ8OYP+0os34xF/fOV4w5/fiaxyq7W05PfgQC2wvEgfpTAt0fMhqoExXDEtydvjbgcOkOWadBDLBwXOt5MX8vuCIEt6Es19TwR51l8yUrpCdYOvFlmse7fH6js6IOVOUGZM0ioSHt7mzEe1elQcbLew5LsKUlp90tOjiagKtGqAWsnLeI0+Hq9vVhk4FmdBz00hjvvEYH2iDhcGt5ry9DOQr/vyRHSNdS+b32bgAOT0ntQIlcD6QHLBtcnDiBEGQf17okIZpEwjE9Cw15++TllUcok+NEutxrKm416DSUAlHafzEskO1FghXLWSGQOBcl9iD2ntoYrVGWs6yNoX72zncJ0KmPPR/LyHNJunscjYITTP6pIhmE3caGrqkcCC62CegplaASXmCnHYTiHZMfF50+KnxOAPhf1XpCuwwSLt2TCWL3gatvhxNRV7pRinhBxb7TfmvJZ3ujpviOJcOcLoFLHUNrYifKsLYZV07LZA8ZiBgBcwGKuF/jvEPRJ2Apppk=
  - secure: QSEiJepQZHwXFN5tpHRp/qwiLMCt1djh2G5hrqPO+v6CgxhCho8esP8W8FojojpThh+Wz24GOYEysaEgVMEknSl17qNAyDbv3XmEWuMKqFTJIJ1ZIrG9BhdtDVpxCUOxkncUbyonjjjZgzEpzbqHq4dgOSfk4/Kj2bH8KUeo896doxGv41WuHtn2wofP62F6zF6xI/jqGKMSVWZZ3QxEzjP/wHRpE2LhPiYd8kkZxI40vbvTjjdgC8INe1gESb01v2xSPeW91eU76IY14pwp+satN6R2fgPkKeCf7dk6eF3qavThP7VUWsDOZvbK1Ru5KMhL7WFgQyJeQ1NhYEl+mhzntbqBFJvEd3oPof3zcxH5yRlZ2S1NdosiWIORbF5JUXnESe+ff86DeSOa3Ld0Jv06PGFa8ANv7ejtacE5xyJ351rWRntlZbb0VBLnB02VSaScRmN7pxvvP6YYd89BiXMlnVZVMRM5eNItCByPsAsGOs7zwHxhXVrkQT4GLNcPghxdJoaHhP2qX9zS/Qy4f1cW10uzM7cHR79Q+hzrhc+fZI3I0dRwCkOmWbcNs7I4bWkVFdAQ+6JlEgg2tj9FoJgrCnt7vCKbePGwJfyDGtwGMXPNleedP08mIpBMd/PoIMqm+BdEN8ysOxtzOzDiqg8b7YLVqBwBRGCRKzgpbEE=
